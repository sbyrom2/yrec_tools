## This program will run int.py on the stars in the list.
#sep 18, 2018 JNT I have updated this to print a bunch of -99 in the results columns and bypass the OnetoSkip mechanic

import os, sys
from numpy import loadtxt
from interp5newnonSeispy3 import interpolator
from time import time

## Specify the input and output files.
infile = 'data_files/dspMLtesterr3bDR17alphaMgood.txt' #A3PMLtesterr3bDR17alphaMlogglt2_noseistest.txt' # #wg7feb2019.txt'
outfile = infile.replace('data_files','new_outfiles').replace('.txt','5ns3.out')

## Read in the stars.
stars = loadtxt(infile,usecols=(0,1,2,3,4,5))
ids, mass, logg, feoh, alfe, teff = zip(*stars)

## Now read in the lines for outputting later. Cut out the header.
stars = open(infile).readlines()[1:]

## Start the output file if it hasn't been opened. Otherwise,
## figure out which stars we've interpolated and skip them
if not os.path.exists(outfile): 
#	open(outfile,'a').write('#StarID\t\tA_ML\n')
	open(outfile,'a').write('## KICID      Mass         Logg       Fe/H          Al/Fe         Teff       C/N           ')
	open(outfile,'a').write('M_err       Logg_err     Fe/H_err     Al/Fe_err      Teff_err      2MASSID       FitML        IntMass    ')
	open(outfile,'a').write('     IntAge          IntC12          IntC13          IntN14          IntXsurf\n')
#	open(outfile,'a').write('6792689\t-99.000000\n')
#	open(outfile,'a').write('8285712\t-99.000000\n')
#	open(outfile,'a').write('8459156\t-99.000000\n')
#	open(outfile,'a').write('8609704\t-99.000000\n')

DoneStars = loadtxt(outfile,usecols=(0,)).tolist()
try: len(DoneStars)
except TypeError: DoneStars = [DoneStars,]

#6819 Grid check
#OnesToSkip=(4937011,4937056,5023953, 5024404, 5024272,5024476, 5024750, 5024851, 5112288, 5112481, 5112373, 5112387, 5112401, 5112786, 5113061,5024272,5112467, 5112491, 5112730, 5112938, 5112950, 5112974, 5200152)
#6791
#OnesToSkip=(2437340,2437496,2437965, 2569935)
#M6711415061
#OnesToSkip=(211406540, 211409660, 211414329, 211415732, 21112459729417056, 211418433, 211420284)
#3836105
#dwarfs
#OnesToSkip = (10658947, 4045066,4137612,8162514,9765062)#(10658947,	4045066,4137612,8162514,9765062)

## For the full Tayar sample, linear ML.
#OnesToSkip = (10089758,10093888,10197619,1027110,10271721,10319045,10329008,10403036,10418503,10514458,10656124,10785390, 10860017,10863535,10992126,10992390, 11018481,11032660,11042388,11046830,11192141,11235573,11243761,11284798,11394497,11415061,11446280,11612320 , 11618043,11653236,11773146, 11824403, 11855387, 12017985, 12020797, 12022099, 12066292,12071521, 12116523 , 12120144, 12301602, 12459729,12602404,12644223, 1432587, 1719297, 1725552 , 1725732,2010137, 2011145,  2017541, 2297793, 2309524, 2437340,2439233 , 2695975, 2696628, 2711432,2711477, 2846051, 2994493,  2995197,3110460,3222519,  3239258, 3347146,3543433, 3633335 , 3645232,3654897, 3662233,3761660, 3833455, 3836105, 3935651, 3958615 , 3964632, 4042300, 4069447, 4070631,4177025, 4280251, 4346266,4380775 , 4480358, 4555456,4571962 , 4663975, 4664515, 4681628, 4738255, 4738610, 4756934,4764422, 	4908025 , 4920044, 5004660,5032701, 5039392, 5041311, 5112481, 5112786, 5113061, 5113910, 5127940,5167972,5184073, 5303930 , 5371676 ,5395942, 5436814, 5446242, 5446355, 5450413, 5456612 , 5458219, 5475271, 5553963, 5616250, 5698156, 5726966,5780782,5858641 , 5983251 , 6208846,6211529, 6308068,  6311518, 6358570, 6385534, 6521069, 6549467,6606428 ,6611219, 6630797, 6679464 , 6762849,6765032 ,6785040, 6952140, 7100955 , 7286739, 7367289 ,7368584, 7375177, 7378357, 7531650,7659773 , 7667900, 7672453, 7673779, 7757271, 7764335,7800922,7941510, 7954576 ,  7966761, 7973937, 7989213, 8008492, 8037100, 8038347, 8041612,8081145, 8082913,8085217,  8106525,8176733,  8176905, 8218803, 8222189, 8231947, 8288278, 8293686 ,8294303, 8345076, 8381505, 8387412, 8459156, 8495082,8495124 , 8543727, 8569991, 8586983, 8587329, 8609704,8643811, 8689860,  8712103, 8736415, 8840004, 8843835, 8844362, 8845361, 8934264, 8952952,8985246,9002577 ,  9021204, 9026209,9049302, 9158119,  9160695,9210141, 9217456 , 9239082, 9268087,	9306046, 9334666, 9335536 , 9339711,9349690,  9390017, 9414068, 9415248, 9451604, 9451604, 9470055,9489078 , 9517003, 9519609, 9636300,9697078, 9697618,  9726045, 9754625, 9821863, 9846098, 9955959, 9965582) #(5371676,8285712, 8459156,8587329,8609704,9390017)
#Full Tayar sample, ML=1.9037 note that I have autoskipped all the ones that crashed the linear ML because time
#OnesToSkip=(10001167, 10006828, 10057670, 10083815, 10089758, 10093888, 10123207, 10124179, 10161943,10190733, 10197619,10207321, 10207524, 1027110 ,10271721,10319045,10329008,10403036,10418503,10514458,10656124,10785390, 10860017,10863535,10992126,10992390, 11018481,11032660,11042388,11046830,11192141,11235573,11243761,11284798,11394497,11415061,11446280,11612320 , 11618043,11653236,11773146, 11824403, 11855387, 12017985, 12020797, 12022099, 12066292,12071521, 12116523 , 12120144, 12301602, 12459729,12602404,12644223, 1432587, 1719297, 1725552 , 1725732,2010137, 2011145,  2017541, 2297793, 2309524, 2437340,2439233 , 2695975, 2696628, 2711432,2711477, 2846051, 2994493,  2995197,3110460,3222519,  3239258, 3347146,3543433, 3633335 , 3645232,3654897, 3662233,3761660, 3833455, 3836105, 3935651, 3958615 , 3964632, 4042300, 4069447, 4070631,4177025, 4280251, 4346266,4380775 , 4480358, 4555456,4571962 , 4663975, 4664515, 4681628, 4738255, 4738610, 4756934,4764422, 	4908025 , 4920044, 5004660,5032701, 5039392, 5041311, 5112481, 5112786, 5113061, 5113910, 5127940,5167972,5184073, 5303930 , 5371676 ,5395942, 5436814, 5446242, 5446355, 5450413, 5456612 , 5458219, 5475271, 5553963, 5616250, 5698156, 5726966,5780782,5858641 , 5983251 , 6208846,6211529, 6308068,  6311518, 6358570, 6385534, 6521069, 6549467,6606428 ,6611219, 6630797, 6679464 , 6762849,6765032 ,6785040, 6952140, 7100955 , 7286739, 7367289 ,7368584, 7375177, 7378357, 7531650,7659773 , 7667900, 7672453, 7673779, 7757271, 7764335,7800922,7941510, 7954576 ,  7966761, 7973937, 7989213, 8008492, 8037100, 8038347, 8041612,8081145, 8082913,8085217,  8106525,8176733,  8176905, 8218803, 8222189, 8231947, 8288278, 8293686 ,8294303, 8345076, 8381505, 8387412, 8459156, 8495082,8495124 , 8543727, 8569991, 8586983, 8587329, 8609704,8643811, 8689860,  8712103, 8736415, 8840004, 8843835, 8844362, 8845361, 8934264, 8952952,8985246,9002577 ,  9021204, 9026209,9049302, 9158119,  9160695,9210141, 9217456 , 9239082, 9268087,	9306046, 9334666, 9335536 , 9339711,9349690,  9390017, 9414068, 9415248, 9451604, 9451604, 9470055,9489078 , 9517003, 9519609, 9636300,9697078, 9697618,  9726045, 9754625, 9821863, 9846098, 9955959, 9965582, 10402207 ,10423340, 10678016, 10857579 ,10921270, 10933775,10966634,11014721, 11190108,  11228549 , 11288779, 11296211, 11509608,11563791,11650039,  11716362, 12111110 , 12115227, 12207740, 12215898, 3936823,3952315, 4041405 ,4143467, 4345370,  4370730,  4737942,	5371173,  5431353, 5602690, 5707416, 5785710, 5857724,5858947, 5860093 , 6044054, 6431941, 6547007, 6878800, 6924105,7019217 ,7048889, 7106052 ,7178170 ,7257193, 7265189, 7594337 ,7596219 ,7808899, 7908109,7936033, 8094277,  8212479, 8300747 ,8410006, 8426108, 8612393, 8683589 , 8914297, 8936877, 9080175,9143834 ,9333501 , 9544002, 9569462, 9593804 , 9637337, 9704258, 9852625, 9886274,9941911 )
#Full Tayar sample, ML=1.724485 note that I have autoskipped everything that failed ML=1.9
#OnesToSkip=(10001167, 10006828, 10057670, 10083815, 10089758, 10093888, 10123207, 10124179, 10161943,10190733, 10197619,10207321, 10207524, 1027110 ,10271721,10319045,10329008,10403036,10418503,10514458,10656124,10785390, 10860017,10863535,10992126,10992390, 11018481,11032660,11042388,11046830,11192141,11235573,11243761,11284798,11394497,11415061,11446280,11612320 , 11618043,11653236,11773146, 11824403, 11855387, 12017985, 12020797, 12022099, 12066292,12071521, 12116523 , 12120144, 12301602, 12459729,12602404,12644223, 1432587, 1719297, 1725552 , 1725732,2010137, 2011145,  2017541, 2297793, 2309524, 2437340,2439233 , 2695975, 2696628, 2711432,2711477, 2846051, 2994493,  2995197,3110460,3222519,  3239258, 3347146,3543433, 3633335 , 3645232,3654897, 3662233,3761660, 3833455, 3836105, 3935651, 3958615 , 3964632, 4042300, 4069447, 4070631,4177025, 4280251, 4346266,4380775 , 4480358, 4555456,4571962 , 4663975, 4664515, 4681628, 4738255, 4738610, 4756934,4764422, 	4908025 , 4920044, 5004660,5032701, 5039392, 5041311, 5112481, 5112786, 5113061, 5113910, 5127940,5167972,5184073, 5303930 , 5371676 ,5395942, 5436814, 5446242, 5446355, 5450413, 5456612 , 5458219, 5475271, 5553963, 5616250, 5698156, 5726966,5780782,5858641 , 5983251 , 6208846,6211529, 6308068,  6311518, 6358570, 6385534, 6521069, 6549467,6606428 ,6611219, 6630797, 6679464 , 6762849,6765032 ,6785040, 6952140, 7100955 , 7286739, 7367289 ,7368584, 7375177, 7378357, 7531650,7659773 , 7667900, 7672453, 7673779, 7757271, 7764335,7800922,7941510, 7954576 ,  7966761, 7973937, 7989213, 8008492, 8037100, 8038347, 8041612,8081145, 8082913,8085217,  8106525,8176733,  8176905, 8218803, 8222189, 8231947, 8288278, 8293686 ,8294303, 8345076, 8381505, 8387412, 8459156, 8495082,8495124 , 8543727, 8569991, 8586983, 8587329, 8609704,8643811, 8689860,  8712103, 8736415, 8840004, 8843835, 8844362, 8845361, 8934264, 8952952,8985246,9002577 ,  9021204, 9026209,9049302, 9158119,  9160695,9210141, 9217456 , 9239082, 9268087,	9306046, 9334666, 9335536 , 9339711,9349690,  9390017, 9414068, 9415248, 9451604, 9451604, 9470055,9489078 , 9517003, 9519609, 9636300,9697078, 9697618,  9726045, 9754625, 9821863, 9846098, 9955959, 9965582, 10402207 ,10423340, 10678016, 10857579 ,10921270, 10933775,10966634,11014721, 11190108,  11228549 , 11288779, 11296211, 11509608,11563791,11650039,  11716362, 12111110 , 12115227, 12207740, 12215898, 3936823,3952315, 4041405 ,4143467, 4345370,  4370730,  4737942,	5371173,  5431353, 5602690, 5707416, 5785710, 5857724,5858947, 5860093 , 6044054, 6431941, 6547007, 6878800, 6924105,7019217 ,7048889, 7106052 ,7178170 ,7257193, 7265189, 7594337 ,7596219 ,7808899, 7908109,7936033, 8094277,  8212479, 8300747 ,8410006, 8426108, 8612393, 8683589 , 8914297, 8936877, 9080175,9143834 ,9333501 , 9544002, 9569462, 9593804 , 9637337, 9704258, 9852625, 9886274,9941911, 10004825,10014893 ,10018442,  10031091,10031856 , 10055674, 10095409, 10200886, 10214295, 10288903, 10291535, 10295441, 10328498,  10331908, 10351528,10351820 , 10352615,10360984 , 10546497, 10547905, 10552929, 10592335, 10711154,10718491, 10743195, 10743515, 10744641,10789202, 10793771, 10810211 ,10813811 , 10905139 , 10932270, 10991798, 11026472, 11075808,11086673 , 11097853,11098753, 11099144 , 11146260, 11147596, 11180468, 11243349,11244968 , 11250488,11288888, 11304421, 11305776 , 11336656,11337843 , 11400880, 11410478, 11494169, 11496569, 11514322,11519735, 11520642,  11559645, 11567563, 11654305, 11667799, 11702480, 11722424, 11725564, 11752396, 11817405, 11821439, 11869095, 11924919, 11954989, 11973569, 12023863 ,12169845, 12254670,  12316126, 12366537, 12366840,1433593, 1433730,2166223, 2303414,2425631 , 2443573 ,  2444348, 2449558, 2583386, 2720096, 2848887, 3102386, 3110733, 3113915, 3230719, 3237572, 3241947,3449907, 3457618 , 3459109,3527891,3530942 ,  3545147,3548732, 3742673, 3747777 ,3849527,3855003,  3860139 ,3946389 ,3954327 , 3954671,4056079 , 4070891,4139784, 4140726 ,4157282, 4262061 , 4279700, 4280424, 4284281,4346953, 4357390,  4357662,4457761, 4469602, 4478281 , 4481622, 4545474, 4567326, 4571324,4577048, 4580189 ,4663478 , 4757071, 4821839, 4826087, 4852480, 4863289,4918748, 4937576 , 4940536, 4946997, 5005508, 5023732, 5032140, 5038397, 5094118, 5105399, 5110961,5112361 , 5112744, 5112880,5112948,5113041 , 5219666,  5285490,5305259, 5308777, 5359241,5371626, 5385518 , 5392313 ,5392657 ,	5394451, 5440488 , 5456086,5477873,  5479483,5522479 ,	5525400,  5534973, 5542222, 5544606, 5566644,5566669 ,5611769,  5630500, 5641322,5689606, 5694720 , 5709265, 	5722272, 5770637, 5774558,5784094 , 5791889,5811766, 5816923, 5822936,5905736, 6047339 , 6058700,6140132 , 6142932,6188215 ,6188269  )  
# Full Tayar sample with SYD
#OnesToSkip=(6122976,6792689,7045503,8285712,8587329,9965582)
# Full Tayar Sarbani Mcor, 
#OnesToSkip=(8285712,8587329)
# Full Tay10214295ar Sarbani Mcor Loggcor
#OnesToSkip=( 8285712, 8587329)
# Full Tayar, Dennis Masses
#OnesToSkip=(10226276,10292156,10418503,2018537,3866912,5371676,7989213,8026963,8285712,8366239,8459156,8587329,8609704,	8824732,9165879,9712510)
# Full Tayar, Aldo Scale
#OnesToSkip=(8285712,8587329,8609704)
# Full Tayar, Aldo Individual
#OnesToSkip=(8587329,8587329)

##OnesToSkip = (5371676,6792689,8285712,8459156,8609704,5113061,3222519,3543433,8569991,9726045)
#Full Tayar, corrected Teffs, quadratic alpha interpolation
#OnesToSkip = (10004825,10004825, 10014959, 10018923, 10023439, 10025387)
#Full Tayar, corrected Teffs, linear alpha interpolation
#OnesToSkip=(10033231,10053392,10053594,10055061,10055196,10090568,10147167, 10206622)
#Full Tayar, corrected Teffs, quadratic alpha interpolation, remove +0.6 option
#OnesToSkip = (10004825, 10014959, 10018923, 10023439, 10025387)
#Full Tayar, corrected Teffs, linear alpha interpolation, remove +0.6 option
#OnesToSkip = (12022099,12022099,3633335,5371676,5376348,5983251,6679464, 6792689,7800922, 8285712,8459156,8587329, 8609704)

## Dennis Sample
#OnesToSkip = (10428163,10453652,10722954,12056819,2164379,4042300,4756934,5371676,5392313,6890257,
#              7831636,8285712,8459156,8462113,8609704,8959259,9334666,9447310,9846098,9880435,)
#OnesToSkip = (10192458,11147333,11722424,2711477,4755560,5284948,5371676,5479483,5940587,6865501,8162973, 7547964, 8285712, 8459156, 8555265, 8609704, 9269772, 9698133, 9904365)

#Clusterfin1
#OnesToSkip=(24206, 24207, 24208, 24209)
#Clusterfin1_mass plus 
#OnesToSkip = (2297384,2297825,2436417,2437496,2437804,2437816,2437965,2569055,2570518,710,711,712)
# mass minus
#OnesToSkip = (1070, 1071, 1072, 1073)
#Diogo 2420
#OnesToSkip = (0,1)
#47tuc
#OnesToSkip = (14, 15)
#M4spectra
#OnesToSkip = (1, 17,30,37, 38, 57,58, 63, 72, 73, 92, 93, 95, 109, 118, 120, 125, 145, 151)
#47tucspectrac
#OnesToSkip=(19, 23, 51, 53, 55, 56, 57, 66, 67, 97,110,121, 135, 136, 168, 183, 192, 215, 221, 230, 237, 246, 263, 273, 285, 296, 325, 335, 340, 354, 356, 358,366, 379, 386, 392, 400, 404, 409, 438, 452, 461, 465, 489, 500, 526, 530)
#Hawkins
#OnesToSkip = (2973894,2973894,10200377,10293335,11349014,9333501,11512096,11083613,10796378,4569691,6844293,9205952, 5685000,9942816,10749112,3849027,9909804,9574650,11250139,5597397, 6594505,10975126,12121207,9405555,4638317,9028511, 11561379,9395535, 9706209, 5461921, 10600926, 10992711, 12120230, 6501676, 11395816, 11357004,8612811, 10002647, 10068810, 5512777, 11196963, 10553844, 10196797, 9330758, 12266056, 11244855, 11753211, 	11342308, 8759207, 9658793, 11599342,7430415, 9264889, 8737032, 7672292, 3934458, 4139914, 10459794, 11468340, 3631092, 9080445, 10263341, 	7267593, 10793890, 9396363, 5080831, 11918016, 9893889, 9641484, 9641246, 3658136, 12122151, 11905393, 4141815, 9898999, 9456478, 8086192, 11247049, 5545303, 10973854 , 11521155, 8677701,3748691,	1725732, 4840774, 11673900, 6266772, 10863535, 10271721, 6188215,9511938, 9887488, 8547669,4636731, 10474071, 9903290, 	9970467, 10603170, 7813414, 11152753, 2141928, 8738333, 6421579, 11072334, 11410217,10858520, 9351186, 6939158, 4991732, 10966950, 10226276, 3734104, 10593078, 9702841, 	9711269, 5371626, 4908025, 11442227, 2696628, 9146423,6508300,6677653, 5200152, 7347195,6756648, 9147335, 6192431,9100325, 3730854,10528911, 3646933, 6025031, 11820688, 	5112734, 8219125, 11753010, 4346319, 9291249,3529480,11513798, 11513798, 11663387, 9767332, 4243796, 6755830, 9727675, 9727675, 	5426041, 10534826, 5024851, 5024851, 2975717, 6026983, 4039831,9470055, 5288607 , 	7591311, 11805876, 10979742, 1725552, 10089758, 	9640886, 	11668246, 9762752, 6928997, 5342486, 11670367, 10395638, 9292180, 11284798, 	3346501, 10592249, 10527754, 5599763, 10992390, 4169130, 2995197, 5112481, 4276070, 11232225, 	9772366, 12168406, 10724041, 10922821, 5859492, 10910802, 11564787, 9166023, 	9329200, 2437965, 11665692, 10290315, 	5515314, 10721900, 10418503, 10972288, 4481621)
#GHB
#OnesToSkip = (8285712, 8609704, 9390017)
#Marcclusters
#OnesToSkip=(33,50,77, 87,90, 150,174, 309, 341, 392, 465, 494, 528, 531, 536)

#Massarotti
#OnesToSkip = (47310,51069,67459,69427,69673,81008,92512)

#Aldo GBM Sep 18 2018
#OnesToSkip=(11566038,1027110, 1431599, 1432587, 1576043, 1719297, 1725552, 1725732, 2011145, 2011870, 2014684, 
#2017541, 2167183, 2297793, 2304765, 2309524, 2437496, 2439233, 2569137, 2579142, 2696628, 2709877, 2711432, 
#2846051, 2846944, 2847114, 2847978, 2994493, 2995197, 3103320, 3110460, 3120889, 3222519, 3236748, 3239258,
#3347146, 3458387, 3527708, 3543433, 3645232, 3646933, 3654897, 3656761, 3658136, 3661182, 3662233, 3662283, 
#3730125, 3735699, 3761660, 3833455, 3836105, 3852304, 3853555, 3935651, 3952315, 3958615, 3964632, 3968545,
#3969220, 4039831)

OnesToSkip=(10324146,10338340) #tip APOKASC, doing something weird
#OnesToSkip=(0,0)

t1 = time()

## Now run the loop.
for i in range(len(ids)):

	#if i > 20: break

	I, M, F, A, L, T = ids[i], [mass[i],], [feoh[i],], [alfe[i],], [logg[i],], [teff[i],]

	print ('\n#', i, '\t', I, '\n')
	## Check that this star hasn't been interpolated before.
	if I in DoneStars: continue

	## Check if its one we want to skip.
	if I in OnesToSkip:
		print ('Skipping this one!')
		lin = '#'+'%.0d'%I+'\t-99.000000\n'
		open(outfile,'a').write(lin)
		continue

	if True: ## Include Age and C/N
		thetef, theml, theage, thec12, thec13, then14, thehyd = interpolator(M, F, A, L, T)[0]

		lin  = stars[i].replace('\n','')
		lin += '       %.4f'%thetef+'\t'
		lin += '   %.6f'%theml+'\t'
		lin += '   %.4e'%theage+'\t'
		lin += '   %.4e'%thec12+'\t'
		lin += '   %.4e'%thec13+'\t'
		lin += '   %.4e'%then14+'\t'
		lin += '   %.4e'%thehyd+'\n'
		open(outfile,'a').write(lin)

	else:
		thetef, theml = interpolator(M, F, A, L, T)[0]

		lin  = stars[i].replace('\n','')
		lin += '       %.1f'%thetef+'\t'
		lin += '   %.6f'%theml+'\n'
		open(outfile,'a').write(lin)


print ('\n\nThis whole run took', time()-t1, 'seconds!')



















