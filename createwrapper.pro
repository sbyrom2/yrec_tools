@createnmls2.pro
pro createwrapper, dir, chars, type
;input is now the number of characters in the beginning of the filename that you wish to preserve

; compile: writecol.pro, createnmls2, createnmls,
; example: createwrapper, 'YRECgrid/nodiff/nodiff_in8', 1, 'MYZagrid'

; note to self, 'mbelow' is being used both for the name mass, and the mass
; we're scaling up from.  these are not always the same.  need to fix (maybe add 
; new variable???



  cd, '~/EVOLUTION/output'
  D=file_search('*.nml2')

  for i=0, n_elements(D)-1 do begin
      filename=strmid(D(i), 0, chars) ;6)  ; This number is the amount of characters in the name
                                       ;that you want to preserve
      fil1=strmid(D(i), 0, strlen(D(i))-10) ;remove the yrec8.nml1     
      
      if type eq 'Rotall' then begin 

        In= filename+'inTsbFjdF'
        Sb=filename+'inFsbTjdF'
        SbJd=filename+'inFsbTjdT'
        Jd=filename+'inFsbFjdT'
        InSb=filename+'inTsbTjdF'
        InJd=filename+'inTsbFjdT'
        InSbJd=filename+'inTsbTjdT'
        Rot=filename+'inFsbFjdF'
 ;      wait, 100
        createnmls, dir, fil1, SbJd, 'LSOLID', '.TRUE.'
        createnmls, dir, SbJd, Jd, 'LSOLID', '.FALSE.'
        createnmls, dir, SbJd, Sb, 'LJDOT0', '.FALSE.'
        createnmls, dir, SbJd, InSbJd, 'LINSTB', '.TRUE.' 
        createnmls, dir, Jd, InJd, 'LINSTB', '.TRUE.'
        createnmls, dir, Sb, InSb, 'LINSTB', '.TRUE.' 
        createnmls, dir, InSb, In, 'LSOLID', '.FALSE.'
        createnmls, dir, Sb, Rot, 'LSOLID', '.FALSE.'
      endif

     if type eq 'Rot' then begin 

        In= filename+'inTsbFjdF'
        Sb=filename+'inFsbTjdF'
        SbJd=filename+'inFsbTjdT'
        Jd=filename+'inFsbFjdT'
        InSb=filename+'inTsbTjdF'
        InJd=filename+'inTsbFjdT'
        InSbJd=filename+'inTsbTjdT'
        Rot=filename+'inFsbFjdF'
 ;      wait, 100
 ;       createnmls, dir, fil1, SbJd, 'LSOLID', '.TRUE.'
        createnmls, dir, SbJd, Jd, 'LSOLID', '.FALSE.'
        createnmls, dir, SbJd, Sb, 'LJDOT0', '.FALSE.'
        createnmls, dir, SbJd, InSbJd, 'LINSTB', '.TRUE.' 
        createnmls, dir, Jd, InJd, 'LINSTB', '.TRUE.'
        createnmls, dir, Sb, InSb, 'LINSTB', '.TRUE.' 
        createnmls,  dir,InSb, In, 'LSOLID', '.FALSE.'
        createnmls,  dir,Sb, Rot, 'LSOLID', '.FALSE.
      endif

     if type eq 'Rotmin' then begin 

        In= filename+'inTsbFjdF'
        Sb=filename+'inFsbTjdF'
        SbJd=filename+'inFsbTjdT'
        Jd=filename+'inFsbFjdT'
        InSb=filename+'inTsbTjdF'
        InJd=filename+'inTsbFjdT'
        InSbJd=filename+'inTsbTjdT'
        Rot=filename+'inFsbFjdF'
 ;      wait, 100
 ;       createnmls, dir, fil1, SbJd, 'LSOLID', '.TRUE.'
 ;       createnmls,  dir,SbJd, Jd, 'LSOLID', '.FALSE.'
 ;       createnmls, dir, SbJd, Sb, 'LJDOT0', '.FALSE.'
 ;       createnmls, dir, SbJd, InSbJd, 'LINSTB', '.TRUE.' 
 ;       createnmls, dir, Jd, InJd, 'LINSTB', '.TRUE.'
 ;       createnmls, dir, Sb, InSb, 'LINSTB', '.TRUE.' 
 ;       createnmls, dir, InSb, In, 'LSOLID', '.FALSE.'
        createnmls,  dir, SbJd, Rot, ['LSOLID', 'LJDOT0'], ['.FALSE.', '.FALSE.']
      endif


      if type eq 'Cali' then begin
 
        dl1= filename+ 'Dl1Fk2_65Fc_62'
        dl2= filename+ 'Dl2Fk2_65Fc_62'
        dl3= filename+ 'Dl3Fk2_65Fc_62'
        Fk1= filename+ 'Dl2Fk1_8Fc_62'
        Fk2= filename+ 'Dl2Fk2_2Fc_62'
        Fk3= filename+ 'Dl2Fk2_6Fc_62'
        Fk4= filename+ 'Dl2Fk3_0Fc_62'
        Fk5= filename+ 'Dl2Fk3_4Fc_62'   
        Fc1= filename+ 'Dl2Fk2_65Fc_0'
        Fc2= filename+ 'Dl2Fk2_65Fc_3'
        Fc3= filename+ 'Dl2Fk2_65Fc_6'
        Fc4= filename+ 'Dl2Fk2_65Fc_9'

       createnmls,  dir,fil1, dl1, 'TDISK', '.01D0'
       createnmls,  dir,fil1, dl2, 'TDISK', '.001D0'
       createnmls, dir, fil1, dl3, 'TDISK', '.0001D0'
       createnmls, dir, dl2, Fk1, 'FK', '1.80'
       createnmls, dir, dl2, Fk2, 'FK', '2.20'
       createnmls, dir, dl2, Fk3, 'FK', '2.60'
       createnmls,  dir,dl2, Fk4, 'FK', '3.00'
       createnmls,  dir,dl2, Fk5, 'FK', '3.40'
       createnmls,  dir,dl2, Fc1, 'FC', '0.0'
       createnmls, dir, dl2, Fc2, 'FC', '0.30'
       createnmls,  dir,dl2, Fc3, 'FC', '0.60'
       createnmls, dir, dl2, Fc4, 'FC', '0.90'

      endif

     if type eq 'MZAgrid' then begin

       ms=['0.75D0', '0.80D0', '0.85D0', '0.90D0']
       mbelow=['075', '080', '085', '090'] 
       zs=['0.003366', '0.001908', '0.001078', '0.0006075', '0.0003421']
       xs=['0.7388', '0.7447', '0.7480', '0.7499', '0.7509']
       zoxs=['m075', 'm100', 'm125', 'm150', 'm175']
       as=['0', '2']
       if (n_elements(zs) ne n_elements(xs) || n_elements(xs) ne n_elements(zoxs)) then begin
            print, 'z, x, z/x lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       if (n_elements(ms) ne n_elements(mbelow)) then begin
            print, 'm, mbelow lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       for i=0, n_elements(ms)-1 do begin
         for j=0, n_elements(zs)-1 do begin
           for k=0, n_elements(as)-1 do begin
             FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"
             if as[k] eq '0' then Fname=FFIRSTbase+"pms/gs98/p"+mbelow(i)+$
                 "gs98z01757.ahbl'"
             if as[k] eq '2' then Fname=FFIRSTbase+"alpha02/p"+mbelow(i)+$
                  "gs98alpha02z01757.ahbl'"
             

             newname=filename+'m'+strmid(ms(i), 2, 2)+'z'+zoxs(j)+'a'+as(k)+'SbJd'
             params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                     'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST']
             values=[ms[i], xs[j], zs[j], xs[j], zs[j],xs[j], zs[j], zs[j], zs[j], $
                    Fname]
             if fil1 ne newname then $
                   createnmls,  dir,fil1, newname, params, values                
           end
         end
       end

     endif

     if type eq 'MYZagrid' then begin
      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     
      print, fil1
      modeltype='_nodiff'
 
;       ms=['0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', '1.50D0', '1.60D0' ]
;       mbelow=['080', '090', '100', '110','120', '130','140', '150','160'] 

;       ys=[0.249, 0.264, 0.279]
;       yname=['249', '264', '279']

;       zh=[0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4]
;       zhname=['p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140']
;
;       as=['18', '13', '23']
;       alphas=['1.8061926D0', '1.3D0', '2.3D0']

       ms=['2.00D0']
       mbelow=['200'] 

       ys=[0.264]
       yname=[ '264']

       zh=[ -0.8]
       zhname=['m080']

       as=['18']
       alphas=['1.8061926D0']

       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
                      
        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]             

        firstoptions=[-2.20, -2.15, -2.10, -2.0, -1.5, -1.25, -1.0, -.5, 0]
        firststr=[ 'm220', 'm215', 'm210', 'm200', 'm150', 'm125', 'm100', 'm050', 'm000']
 

;       if (n_elements(zs) ne n_elements(xs) || n_elements(xs) ne n_elements(zoxs)) then begin
;            print, 'z, x, z/x lists not same length- please fix and retry'
;            cd, '~/EVOLUTION/output/idl'
;            return
;       endif
       if (n_elements(ms) ne n_elements(mbelow)) then begin
            print, 'm, mbelow lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(ys)-1 do begin
           for k=0, n_elements(zh)-1 do begin
             for l=0, n_elements(as)-1 do begin 

;                FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"
;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow(ii)+$
;                   "gs98z01757.ahbl'"
                 firstnum=value_locate(firstoptions, zh[k])
                 if firstnum ne n_elements(firstoptions)-1 then firstnum=firstnum+1
               FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts/m"
                
                Fname=FFIRSTbase+mbelow(ii)+"zh"+firststr(firstnum)+"y264a18_nodiff.last'"


;               if as[k] eq '2' then Fname=FFIRSTbase+"alpha02/p"+mbelow(i)+$
;                    "gs98alpha02z01757.ahbl'"
             

;                 newname=filename+'m'+strmid(ms(ii), 2, 2)+'z'+zoxs(j)+'a'+as(l)+'_nodiff'
                 xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar  ;2025 jamie is pretty sure this should be 0.0231 rather than protosolar? :/ awkward
                 zcalc=1-ys[j]-xcalc
                 xcs=string(xcalc)
                 zcs=string(zcalc)
                 xstr=strmid(strcompress(xcs, /remove_all), 0, 11)
                 zstr=strmid(strcompress(zcs, /remove_all), 0, 11)

                 opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
                 opnum=value_locate(opaloptions, zcalc)
                 opname=opbase+opalstr[opnum]+'"'
                 atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                 atmnum=value_locate(atmoptions, zh[k])
                 atmname=atmbase+atmstr[atmnum+1]+'.tab"'                
                 

                 newname='m'+mbelow(ii)+'zh'+zhname(k)+'y'+yname(j)+'a'+as(l)+modeltype
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FATM']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas[l], alphas[l], atmname]
                 if fil1 ne newname then $
                       createnmls2,  dir,fil1, newname, params, values  
                               
             end
           end
         end
       end

     endif


     if type eq 'MYZaAlphagrid' then begin
      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     
      print, fil1
 
      

       ms=['0.60D0', '0.70D0', '0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', $
           '1.50D0', '1.60D0', '1.70D0', '1.80D0', '1.90D0', '2.00D0', '2.10D0', '2.20D0', $
           '2.30D0', '2.40D0', '2.50D0', '2.60D0'  ]
       mname=['060', '070','080', '090', '100', '110','120', '130','140', '150','160',$
              '170', '180','190', '200', '210', '220','230', '240','250', '260']

       ys=[0.249, 0.264, 0.279]
       yname=['249', '264', '279']

       zh=[0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4, -1.6, -1.8, -2.0]
       zhname=['p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140','m160', 'm180', 'm200']

       as=['18', '13', '23']
       alphas=['1.792387D0', '1.292387D0', '2.292387D0']

 
       zh=[0.0]
       zhname=['m000']
;        ms=[ $
;           '2.00D0', '2.10D0', '2.20D0', $
;           '2.30D0', '2.40D0', '2.50D0', '2.60D0'  ]
;       mname=[ '200', '210', '220','230', '240','250', '260']
;       ms=['0.60D0', '0.70D0', '0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', $
;           '1.50D0', '1.60D0', '1.70D0', '1.80D0', '1.90D0' ]
;       mname=['060', '070','080', '090', '100', '110','120', '130','140', '150','160',$
;              '170', '180','190']

;       ms=['0.60D0', '2.60D0']
;      mname=['060', '260']
;       zh=[-2.0, 0.4]
;       zhname=['m200', 'p040']
       ys=[ 0.264838]
       yname=[ '264']
       as=['18'] ; ,'26']
       alphas=['1.8061926D0'] ;, '2.55']
;      alphas=['1.792387D0']
;        ms=[ $
;           '2.20D0', $
;            '2.60D0'  ]
;       mname=[  '220', '260']
;       ms=['0.60D0',  '1.00D0', '1.40D0', $
;            '1.80D0' ]
;       mname=['060', '100', '140', '180']

;       ms=['0.60D0',  '1.00D0', '1.40D0', $
;            '1.80D0' ]
;       mname=['060', '100', '140', '180']

;       zh=[0.60, 0.70]
;       zhname=['p060', 'p070']


       aenhances=['02']

       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364, $
                    .044373926, .045081929, .045081991, .046300359, .046300423, .047584367, $
                    .060131645, .060831381, .061801969, .063472292, .067127050, .067908189, $
                    .068991690, .070856330, .077050371, .090863722, .118215775, .600000000]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364', $
                    '.044373926', '.045081929', '.045081991', '.046300359', '.046300423', '.047584367', $
                    '.060131645', '.060831381', '.061801969', '.063472292', '.067127050', '.067908189', $
                    '.068991690', '.070856330', '.077050371', '.090863722', '.118215775', '.600000000']
                      
        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]  
     
        newatmoptions=[-4.0,-2.5, -2.0, -1.5, -1,$
                       -.5, 0.0, 0.5 ]
        newatmstr=[ 'm40', 'm25',   'm20','m15','m10',$
                    'm05','p00', 'p05' ]    

        moptions=[.15, .20, .25, .30, .35, .40, .45, .50, .55, .60, .65, .70, .75, .80, $
                  .85, .90, .95, 1.0, 1.05, 1.10, 1.15, $
                  1.20, 1.25, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, 2.00, 2.25, 2.50, 2.80]      
        mstr=['015', '020', '025', '030', '035', '040', '045', '050', '055', '060', '065', '070', '075', $
                  '080', '085', '090', '095', '100', '105', '110', '115', $
                  '120', '125', '130', '140', '150', '160', '170', '180', '190', '200', '225', '250', '280']

        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.30, 2.40, 2.50]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220', '230', '240', '250']
       zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']


;       if (n_elements(zs) ne n_elements(xs) || n_elements(xs) ne n_elements(zoxs)) then begin
;            print, 'z, x, z/x lists not same length- please fix and retry'
;            cd, '~/EVOLUTION/output/idl'
;            return
;       endif
       if (n_elements(ms) ne n_elements(mname)) then begin
            print, 'm, mname lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
      for m=0, n_elements(aenhances)-1 do begin
          aenhance=aenhances[m]
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(ys)-1 do begin
           for k=0, n_elements(zh)-1 do begin
             for l=0, n_elements(as)-1 do begin 


                 mnum=value_locate(moptionsnew, ms[ii])
                 if ms[ii] lt moptionsnew(mnum) then mnum=mnum-1
                 mbelow=mstrnew[mnum]
                 znum=value_locate(zoptionsnew, zh[k])
                 zbelow=zstrnew[znum]

                FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"

;for the alpha enhancement zero stars, use the newstarts2 grid of starting models so that 
; we don't have to rescale so far at various metallicities 
                if aenhance eq '00' then begin
 


                      kttau='3'
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'

;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"
                      FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts2/"
                      Fname=FFIRSTbase+'m'+mbelow+'zh'+zbelow+'y'+'264'+'a'+'18'+"_nodiff.last'"
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
                endif else if aenhance eq '04' then begin
                      kttau='5'
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al04.tab"'   
                      FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts2/"
                      Fname=FFIRSTbase+'m'+mbelow+'zh'+zbelow+'y'+'264'+'a'+'18'+"al04_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else begin
                      kttau='0' ; run a gray atmosphere for alphas in neither kurucz nor castelli
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
                          "gs98alpha"+aenhance+"z01757.ahbl'"
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                endelse

;               if as[k] eq '2' then Fname=FFIRSTbase+"alpha06/p"+mbelow(i)+$
;                    "gs98alpha02z01757.ahbl'"
             

;                 newname=filename+'m'+strmid(ms(ii), 2, 2)+'z'+zoxs(j)+'a'+as(l)+'_nodiff'
                 xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar
                 zcalc=1-ys[j]-xcalc
                 xcs=string(xcalc)
                 zcs=string(zcalc)
                 xstr=strmid(strcompress(xcs, /remove_all), 0, 9)
                 zstr=strmid(strcompress(zcs, /remove_all), 0, 9)

                 opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
                 opnum=value_locate(opaloptions, zcalc)
                 opname=opbase+opalstr[opnum]+'"'
;                 atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
;                 atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
;                 atmname=atmbase+atmstr[atmnum]+'.tab"'                
                

                 newname='m'+mname(ii)+'zh'+zhname(k)+'y'+yname(j)+'a'+as(l)+'al'+aenhance+'_nodiff'
;                 newname='m'+mname(ii)+'zh'+zhname(k)+'y'+yname(j)+'a'+as(l)+'al'+aenhance+'_nodifv'
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FLIV95 ', 'FATM', 'KTTAU']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas[l], alphas[l], opal95, atmname, kttau]

                 if fil1 ne newname then $
                       createnmls2,  dir,fil1, newname, params, values  
        
             end
           end
         end
       end
     end
     endif

   if type eq 'newstarts' then begin
      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     
      print, fil1

      makesolar='F' ;set to 'T' if your making solar metallicity templates

       ms=['0.80D0'];, '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', '1.50D0', '1.60D0', $
;           '0.60D0', '0.70D0', '1.70D0', '1.80D0', '1.90D0', '2.00D0', '2.10D0', '2.20D0', $
;           '2.30D0','2.40D0', '2.50D0', '2.60D0' ]

       mname=['080'];, '090', '100', '110','120', '130','140', '150','160', $ 
;              '060', '070', '170', '180','190', '200','210', '220','230','240', '250','260'] 

;       ys=[0.249, 0.264, 0.279]
;       yname=['249', '264', '279']

;       zh=[0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4]
;       zhname=['p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140']
;
;       as=['18', '13', '23']
;       alphas=['1.8061926D0', '1.3D0', '2.3D0']

;       ms=[ '2.10D0', '2.20D0', $
;           '2.30D0','2.40D0',  '2.60D0' ]

;       mname=['210', '220','230','240','260'] 


       ys=[ 0.264]
       yname=[ '264']

;       zh=[  0.40, 0.00, -0.40, -0.80,-1.20, -1.60, -2.00, 0.00] ;LAST ENTRY MUST BE INITIAL STARTING Z
;       zhname=[ 'p040', 'm000', 'm040', 'm080', 'm120','m160', 'm200', 'm000']; LAST ENTRY MUST BE INTIAL STARTING Z

;       zh=[  0.40,  0.00] ;LAST ENTRY MUST BE INITIAL STARTING Z
;       zhname=[ 'p040', 'm000']; LAST ENTRY MUST BE INTIAL STARTING Z

       zh=[  -2.00, -2.10, -2.20, -2.30, -2.40, -2.50,  -2.00] ;LAST ENTRY MUST BE INITIAL STARTING Z
       zhname=[ 'm200','m210', 'm220','m230','m240', 'm250', 'm200']; LAST ENTRY MUST BE INTIAL STARTING Z


       as=['18']
       alphas=['1.8061926D0']

       aenhances=['00', '02', '04']

if makesolar eq 'T' then begin
       zh=[  0.00,0.00] ;LAST ENTRY MUST BE INITIAL STARTING Z   makes solar metallicity templates
       zhname=[ 'm000', 'm000']; LAST ENTRY MUST BE INTIAL STARTING Z
endif

       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
if makesolar eq 'T' then begin        
        moptionsnew=[.15, .20, .25, .30, .35, .40, .45, .50, .55, .60, .65, .70, .75, .80, .85, .90, .95, $
                  1.0, 1.05, 1.10, 1.15, $
                  1.20, 1.25, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, 2.00, 2.25, 2.50, 2.80]      
        mstrnew=['015', '020', '025', '030', '035', '040', '045', '050', '055', '060', '065', '070', '075', $
                  '080', '085', '090', '095', '100', '105', '110', '115', $
                  '120', '125', '130', '140', '150', '160', '170', '180', '190', '200', '225', '250', '280']
endif else begin
        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.25, 2.30, 2.40, 2.50, 2.60]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220','225', '230', '240', '250', '260']
endelse
        zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']

        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]             
        newatmoptions=[-4.0,-2.5, -2.0, -1.5, -1,$
                       -.5, 0.0, 0.5 ]
        newatmstr=[ 'm40', 'm25',   'm20','m15','m10',$
                    'm05','p00', 'p05' ]    


;       if (n_elements(zs) ne n_elements(xs) || n_elements(xs) ne n_elements(zoxs)) then begin
;            print, 'z, x, z/x lists not same length- please fix and retry'
;            cd, '~/EVOLUTION/output/idl'
;            return
;       endif
       if (n_elements(ms) ne n_elements(mname)) then begin
            print, 'm, mname lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(ys)-1 do begin
           for k=0, n_elements(zh)-2 do begin
             for l=0, n_elements(as)-1 do begin 
               for mm=0, n_elements(aenhances)-1 do begin 
                 aenhance=aenhances[mm]

print, aenhance

;                FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts2/"
;                Fname=FFIRSTbase+'m'+mbelow+'zh'+zhname(k-1)+'y'+yname(j)+'a'+as(l)+'al'+aenhances[mm]+"_nodiff.last'"
                 FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"
                 km1=k-1
               print, k, km1
                 if km1 eq -1 then km1= (n_elements(zh)-1)
		print, km1 

                      mnum=value_locate(moptionsnew, ms[ii])
                      if ms[ii] lt moptionsnew(mnum) then mnum=mnum-1
                      mbelow=mstrnew[mnum]
                      znum=value_locate(zoptionsnew, zh[k])
                      zbelow=zstrnew[znum]

                if aenhance eq '00' then begin
                      kttau='3'
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'

;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"
;                      FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zhname(km1)+'y'+yname[j]+'a'+as[l]+"al00_nodiff.last'"
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
                endif else if aenhance eq '04' then begin
                      kttau='5'
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al04.tab"'   
;                      FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zhname(km1)+'y'+yname[j]+'a'+as[l]+"al04_nodiff.last'"
                endif else begin
                      kttau='0'
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'al'+aenhance+'.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zhname(km1)+'y'+yname[j]+'a'+as[l]+'al' + aenhance+"_nodiff.last'"
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                endelse


; make solar metallicity templates
              if makesolar eq 'T' then begin
                FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"
                Fname=FFIRSTbase+'alpha'+aenhance+"/p"+mbelow+"gs98alpha"+aenhance+"z01757.ahbl'"
                if aenhance eq '00' then Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"
              endif
             
                 

   		 if aenhance eq '00' then xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar
		 if aenhance eq '02' then xcalc=(1.-ys[j])/(1.+1.383*10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar  ;see Garretts email explaining the correction factors
		 if aenhance eq '04' then xcalc=(1.-ys[j])/(1.+1.993*10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar	
                 zcalc=1-ys[j]-xcalc
                 xcs=string(xcalc)
                 zcs=string(zcalc)
                 xstr=strmid(strcompress(xcs, /remove_all), 0, 11)
                 zstr=strmid(strcompress(zcs, /remove_all), 0, 11)

                 opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
                 opnum=value_locate(opaloptions, zcalc)
                 opname=opbase+opalstr[opnum]+'"'
;                 atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
;                 atmnum=value_locate(atmoptions, zh[k-1])
;                 atmname=atmbase+atmstr[atmnum]+'.tab"'                

                 newname='m'+mname(ii)+'fh'+zhname(k)+'y'+yname(j)+'a'+as(l)+'al'+aenhance+'_nodiff'
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FLIV95 ', 'FATM', 'KTTAU']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas[l], alphas[l], opal95, atmname, kttau]

                 if (fil1 ne newname and (makesolar eq 'T' or (makesolar eq 'F' and zh(k) ne 0.00))) then $
                       createnmls2,  dir,fil1, newname, params, values  
                               
              end
             end
           end
         end
       end

     endif


     if type eq 'Mrotgrid' then begin

      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     

      print, fil1

       ms=['2.0D0','2.2D0', '2.4D0', '2.6D0', '2.8D0', '3.0D0']
       mbelow=['200', '200', '225', '250', '280', '280']
       mname=['200', '220', '240', '260', '280', '300'] 
       
       worig=['0', '7.5D-7', '1.00D-6', '2.5D-6', '5.0D-6', '7.5D-6', '1.0D-5', '2.5D-5']
       wname=['0', '75e7', '10e6', '25e6', '50e6', '75e6', '10e5', '25e5'] 
       Tdisk=['0.001d0','0.003d0','0.010d0']
       Tdname=['1e3', '3e3', '1e2']

       worig=[ '1.0D-5']
       wname=['10e5'] 
       Tdisk=['0.0006d0']
       Tdname=[ '6e4']

       ms=['1.8D0', '1.4D0','2.0D0']
       mbelow=[ '180', '140', '200']
       mname=[ '180','140','200']       

       as='0'

       if (n_elements(ms) ne n_elements(mbelow)) then begin
            print, 'm, mbelow lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       for i=0, n_elements(ms)-1 do begin
         for j=0, n_elements(worig)-1 do begin
           for k=0, n_elements(Tdisk)-1 do begin
             FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"
             if as eq '0' then Fname=FFIRSTbase+"pms/gs98/p"+mbelow(i)+$
                 "gs98z01757.ahbl'"
;             if as[k] eq '2' then Fname=FFIRSTbase+"alpha02/p"+mbelow(i)+$
;                  "gs98alpha02z01757.ahbl'"
             

             newname='m'+mname[i]+'w'+wname[j]+'Td'+Tdname(k)+'Sb'
             params=['RSCLM(1)', 'FFIRST', 'WNEW', 'TDISK', 'PDISK']
             values=[ms[i], Fname, worig[j], Tdisk[k], worig[j]]
             if fil1 ne newname then $
                   createnmls2,  dir,fil1, newname, params, values                
           end
         end
       end

     endif


     if type eq 'MZgrid' then begin

      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 4, strlen(D(0))-10-4) ;remove the yrec8.nml2     
      startfil1=strmid(D(0), 0, strlen(D(0))-10)
      print, fil1

       ms=['2.00D0', '3.00D0']
       mname=['200', '300'] 

      
       zh=[0.4, -0.4, -0.8, -1.2]
       zhname=['p040', 'm040', 'm080',  'm120']

       ys=.264
       as='00'

       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
         
        moptions=[.15, .20, .25, .30, .35, .40, .45, .50, .55, .60, .65, .70, .75, .80, .85, .90, .95, $
                  1.0, 1.05, 1.10, 1.15, $
                  1.20, 1.25, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, 2.00, 2.25, 2.50, 2.80]      
        mstr=['015', '020', '025', '030', '035', '040', '045', '050', '055', '060', '065', '070', '075', $
                  '080', '085', '090', '095', '100', '105', '110', '115', $
                  '120', '125', '130', '140', '150', '160', '170', '180', '190', '200', '225', '250', '280']


        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]             
        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.25, 2.30, 2.40, 2.50]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220','225', '230', '240', '250']
       zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']


       if (n_elements(ms) ne n_elements(mname)) then begin
            print, 'm, mname lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       for i=0, n_elements(ms)-1 do begin
         for j=0, n_elements(zh)-1 do begin
           for k=0, n_elements(D)-1 do begin

      fil1=strmid(D(k), 4, strlen(D(k))-10-4) ;remove the yrec8.nml2     
      startfil1=strmid(D(k), 0, strlen(D(k))-10)
      print, fil1

             FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"



;Fname=FFIRSTbase+"pms/gs98/p"+mbelow(i)+$
 ;                "gs98z01757.ahbl'"

                 mnum=value_locate(moptionsnew, ms[i])
                 if ms[i] lt moptionsnew(mnum) then mnum=mnum-1
                 mbelow=mstrnew[mnum]
                 znum=value_locate(zoptionsnew, zh[j])
                 zbelow=zstrnew[znum]

;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"
                    FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts2/"
                    Fname=FFIRSTbase+'m'+mbelow+'zh'+zbelow+'y'+'264'+'a'+'18'+"_nodiff.last'"



;             if as[k] eq '2' then Fname=FFIRSTbase+"alpha02/p"+mbelow(i)+$
;                  "gs98alpha02z01757.ahbl'"

                 xcalc=(1.-ys)/(1.+10^(zh[j]+ALOG10(0.0253))) ;GS1998 Protosolar
                 zcalc=1-ys-xcalc
                 xcs=string(xcalc)
                 zcs=string(zcalc)
                 xstr=strmid(strcompress(xcs, /remove_all), 0, 9)
                 zstr=strmid(strcompress(zcs, /remove_all), 0, 9)

                 opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
                 opnum=value_locate(opaloptions, zcalc)
                 opname=opbase+opalstr[opnum]+'"'
                 atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                 atmnum=value_locate(atmoptions, zh[j])         ; changed from k-1 to k
                 atmname=atmbase+atmstr[atmnum]+'.tab"'                
                
                 if as eq '00' then begin
                     opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'
                 endif else begin
                     opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"' 
                 endelse

             

                 newname=fil1+'m'+mname[i]+'zh'+zhname[j]
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'FATM']
                 values=[ms[i], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname,  atmname]

             if fil1 ne newname then $
                   createnmls2,  dir,startfil1, newname, params, values                
           end
         end
       end

     endif
     if type eq 'MYZaAlphaAtmgrid' then begin   ;Final Mixing length grid
      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     
      print, fil1
 
      

       ms=['0.60D0', '0.70D0', '0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', $
           '1.50D0', '1.60D0', '1.70D0', '1.80D0', '1.90D0', '2.00D0', '2.10D0', '2.20D0', $
           '2.30D0', '2.40D0', '2.50D0', '2.60D0'  ]
       mname=['060', '070','080', '090', '100', '110','120', '130','140', '150','160',$
              '170', '180','190', '200', '210', '220','230', '240','250', '260']

       ys=[0.239, 0.272683, 0.290,0.330]
       yname=['239', '273', '290','330']

       zh=[0.60, 0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4, -1.6, -1.8, -2.0]
       zhname=['p060','p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140','m160', 'm180', 'm200']

       as=['17', '12', '22']
       alphas=['1.724485D0', '1.224485D0', '2.224485D0']
; for castelli/kurucz atype=5,  ys=[ 0.265116], alphas=['1.754000D0']
; for grey atype=0,  ys=[ 0.265205], alphas=['1.699653D0'] ; with o3 numerics, actually '1.695867D0',0.264585

       atype='0'  
       atypename='gr' ;'ck'
 
       aenhances=['00', '02','04']



;       zh=[0.6]
;       zhname=['p060'];
;        ms=[ $
;           '2.00D0', '2.10D0', '2.20D0', $
;           '2.30D0', '2.40D0', '2.50D0', '2.60D0'  ]
;       mname=[ '200', '210', '220','230', '240','250', '260']
;       ms=['0.60D0', '0.70D0', '0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', $
;           '1.50D0', '1.60D0', '1.70D0', '1.80D0', '1.90D0' ]
;       mname=['060', '070','080', '090', '100', '110','120', '130','140', '150','160',$
;              '170', '180','190']

;        ms=[ $
;           '2.00D0', '2.10D0',  $
;           '2.30D0', '2.40D0', '2.50D0'  ]
;       mname=[ '200', '210','230', '240','250']
;       ms= ['0.70D0', '0.80D0', '0.90D0',  '1.10D0', '1.20D0', '1.30D0',  $
;         '1.50D0', '1.60D0', '1.70D0',  '1.90D0' ]
;       mname=[ '070','080', '090',  '110','120', '130', '150','160',$
;              '170', '190']

;       zh=[0.40, 0.00,  -0.4, -0.8,   -1.2, -1.6, -2.0]
;       zhname=['p040',  'm000', 'm040',  'm080', 'm120', 'm160',  'm200']
;       zh=[ 0.20, -0.2,  -0.6,  -1.0, -1.4, -1.8]
;       zhname=[ 'p020', 'm020','m060', 'm100',  'm140', 'm180']



       ms=['0.90D0']
       mname=['090']
       zh=[ -0.46, -0.31]
       zhname=['m046','m031']
       ys=[0.272683]
       yname=[ '273']
       as=['17'];
       alphas=['1.724485D0']
       atype='0'  
       atypename='gr'

       aenhances=['00']

; for castelli/kurucz atype=5,  ys=[ 0.265116], alphas=['1.754000D0']
; for grey atype=0,  ys=[ 0.265205], alphas=['1.699653D0']





       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
                      
        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]  
     
        newatmoptions=[-4.0,-2.5, -2.0, -1.5, -1,$
                       -.5, 0.0, 0.5 ]
        newatmstr=[ 'm40', 'm25',   'm20','m15','m10',$
                    'm05','p00', 'p05' ]    

        moptions=[.15, .20, .25, .30, .35, .40, .45, .50, .55, .60, .65, .70, .75, .80, $
                  .85, .90, .95, 1.0, 1.05, 1.10, 1.15, $
                  1.20, 1.25, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, 2.00, 2.25, 2.50, 2.80]      
        mstr=['015', '020', '025', '030', '035', '040', '045', '050', '055', '060', '065', '070', '075', $
                  '080', '085', '090', '095', '100', '105', '110', '115', $
                  '120', '125', '130', '140', '150', '160', '170', '180', '190', '200', '225', '250', '280']

        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.30, 2.40, 2.50, 2.60]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220', '230', '240', '250', '260']
       zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']


;       if (n_elements(zs) ne n_elements(xs) || n_elements(xs) ne n_elements(zoxs)) then begin
;            print, 'z, x, z/x lists not same length- please fix and retry'
;            cd, '~/EVOLUTION/output/idl'
;            return
;       endif
       if (n_elements(ms) ne n_elements(mname)) then begin
            print, 'm, mname lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
      for m=0, n_elements(aenhances)-1 do begin
          aenhance=aenhances[m]
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(ys)-1 do begin
           for k=0, n_elements(zh)-1 do begin
             for l=0, n_elements(as)-1 do begin 


                 mnum=value_locate(moptionsnew, ms[ii])
                 if ms[ii] lt moptionsnew(mnum) then mnum=mnum-1
                 mbelow=mstrnew[mnum]
                 znum=value_locate(zoptionsnew, zh[k])
                 zbelow=zstrnew[znum]

                 FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"

;for the alpha enhancement zero stars, use the newstarts2 grid of starting models so that 
; we don't have to rescale so far at various metallicities 
                if aenhance eq '00' then begin
 


                      kttau=atype
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'

;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"

                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al00_nodiff.last'"
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
                      if atype eq '5' then begin
                             atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                             atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                             atmname=atmbase+newatmstr[atmnum]+'.tab"'  
                      endif
                endif else if aenhance eq '04' then begin
                      kttau=atype
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al04.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al04_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else if aenhance eq '02' and atype eq '0' then begin
                      kttau=atype
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al02.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al02_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else begin
                      kttau=atype
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
	              FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"
                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
                          "gs98alpha"+aenhance+"z01757.ahbl'"
                     opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                endelse

;               if as[k] eq '2' then Fname=FFIRSTbase+"alpha06/p"+mbelow(i)+$
;                    "gs98alpha02z01757.ahbl'"

       

;                 newname=filename+'m'+strmid(ms(ii), 2, 2)+'z'+zoxs(j)+'a'+as(l)+'_nodiff'
;                 xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar

   		 if aenhance eq '00' then xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar
		 if aenhance eq '02' then xcalc=(1.-ys[j])/(1.+1.383*10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar  ;see Garretts email explaining the correction factors
		 if aenhance eq '04' then xcalc=(1.-ys[j])/(1.+1.993*10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar	

                 zcalc=1-ys[j]-xcalc
                 xcs=string(xcalc)
                 zcs=string(zcalc)
                 xstr=strmid(strcompress(xcs, /remove_all), 0, 9)
                 zstr=strmid(strcompress(zcs, /remove_all), 0, 9)

                 opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
                 opnum=value_locate(opaloptions, zcalc)
                 opname=opbase+opalstr[opnum]+'"'
;                 atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
;                 atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
;                 atmname=atmbase+atmstr[atmnum]+'.tab"'                
                

                 newname='m'+mname(ii)+'fh'+zhname(k)+'y'+yname(j)+'a'+as(l)+'al'+aenhance+'_'+atypename+'nodf'
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FLIV95 ', 'FATM', 'KTTAU']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas[l], alphas[l], opal95, atmname, kttau]

                 if fil1 ne newname then $
                       createnmls2,  dir,fil1, newname, params, values  
        
             end
           end
         end
       end
     end
     endif

     if type eq 'Diffrotgrid' then begin

      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      for i=0, n_elements(D)-1 do begin

      fil1=strmid(D(i), 0, strlen(D(i))-10) ;remove the yrec8.nml2     
      fil2=strmid(D(i), 0, strlen(D(i))-19) ; used to be 13 remove the inFsbTjdTyrec8.nml2 
      print, fil1

      is=[ '3']
      iname=[ 'I3']

      walps=['0.0', '-1.0', '-2.0','-0.5', '-1.5']
      walpname=['cz00', 'cz10', 'cz20','cz05', 'cz15']


       if (n_elements(ms) ne n_elements(mbelow)) then begin
            print, 'm, mbelow lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
       for ii=0, n_elements(is)-1 do begin
         for j=0, n_elements(walps)-1 do begin

             newname=fil1+iname(ii)+walpname(j)
             params=['IMPJMOD', 'WALPCZ', 'LSOLID']
             values=[is[ii], walps[j], '.FALSE.']
             if fil1 ne newname then $
                   createnmls2,  dir,fil1, newname, params, values                

         end
       end
     end
     endif

     if type eq 'FFT' then begin
;change any to FFT

      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      for i=0, n_elements(D)-1 do begin

      fil1=strmid(D(i), 0, strlen(D(i))-10) ;remove the yrec8.nml2     
      fil2=strmid(D(i), 0, strlen(D(i))-13) ; used to be 13 remove the inFsbTjdTyrec8.nml2 
      print, fil1
      newname=fil2+'FFT'

             if fil1 ne newname then $
                   createnmls2,  dir,fil1, newname, ['LINSTB','LSOLID','LJDOT0'], ['.FALSE.','.FALSE.' ,'.TRUE.']
         
       
     end
     endif

     if type eq 'Mrotgrid2' then begin ;Tayar and Pinsonneault 2018 grid? I think?

      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     

      print, fil1

;       ms=['2.0D0','2.2D0', '2.4D0', '2.6D0', '2.8D0', '3.0D0']
;       mbelow=['200', '200', '225', '250', '280', '280']
;       mname=['2_0', '2_2', '2_4', '2_6', '2_8', '3_0'] 

;       ms=['1.0D0','1.2D0', '1.4D0', '1.6D0', '1.8D0']
;       mbelow=['200', '200', '225', '250', '280', '280']
;       mname=['1_0', '1_2', '1_4', '1_6', '1_8'] 
;       ms=['0.8D0', '1.0D0','1.2D0', '1.4D0', '1.6D0', '1.8D0','2.0D0','2.2D0', '2.4D0', '2.6D0', '2.8D0', '3.0D0']
;       mname=['0_8','1_0', '1_2', '1_4', '1_6', '1_8','2_0', '2_2', '2_4', '2_6', '2_8', '3_0'] 
 
;runing toi 197
       ms=['1.1D0', '1.15D0','1.2D0', '1.25D0', '1.30D0', '1.35D0','1.4D0','1.45D0', '1.50D0']
       mname=['1_10','1_15', '1_20', '1_25', '1_30', '1_35','1_40', '1_45', '1_50'] 
 
;      zh=['0.0']


;       zh=[0.60, 0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4, -1.6, -1.8, -2.0]
;       zhname=['p060','p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140','m160', 'm180', 'm200']
;       zh=[0.30,0.0, -0.3]
;       zhname=['p03','m00', 'm03']

       zh=[-0.16,0.00, -0.08]
       zhname=['m016','m000', 'm008']

;       worig=['5.0D-8', '2.5D-6', '5.0D-6', '7.5D-6', '1.0D-5', '1.0D-5', '1.0D-5']
;       Tdisk=['0.001d0','0.001d0', '0.001d0', '0.001d0', '0.001d0', '0.0008d0','0.0006d0']
;       wname=['w0','w1', 'w2', 'w3', 'w4', 'w5', 'w6']
       worig=[ '7.5D-6']
       Tdisk=[ '0.001d0']
       wname=[ 'w3']

      ys=['cali'] ;0.272683
       as='0'  ; doesn't actually use this I think, which is how we ended up with Kurucz instead of gray atmospheres

       aenhances=['00'] ;the problem is if this is 00 i've been using kurucz atmospheres. but can't do alpha enhanced kurucz trivially, so want to do grey in other cases. use 00 only here, use subgiant grid below if you need additional complexity

       if (n_elements(worig) ne n_elements(Tdisk)) then begin
            print, 'worig, Tdisk lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif


       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
                      
        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]  
     
        newatmoptions=[-4.0,-2.5, -2.0, -1.5, -1,$
                       -.5, 0.0, 0.5 ]
        newatmstr=[ 'm40', 'm25',   'm20','m15','m10',$
                    'm05','p00', 'p05' ]    


        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.30, 2.40, 2.50, 2.60]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220', '230', '240', '250', '260']
       zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']

      for m=0, n_elements(aenhances)-1 do begin
          aenhance=aenhances[m]
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(zh)-1 do begin
           for k=0, n_elements(Tdisk)-1 do begin
             
             mnum=value_locate(moptionsnew, ms[ii])
             if ms[ii] lt moptionsnew(mnum) then mnum=mnum-1
             mbelow=mstrnew[mnum]
             znum=value_locate(zoptionsnew, zh[j])
             zbelow=zstrnew[znum]



;calculate x and z assuming Tayar 2017 delta Y/delta Z
              if aenhance eq '00' then xcalc=(1.0-0.2485)/(2.3426*(1.+10^(zh[j]+ALOG10(0.0253)))-1.3426)
              if aenhance eq '02' then xcalc=(1.0-0.2485)/(2.3426*(1.+1.383*10^(zh[j]+ALOG10(0.0253)))-1.3426)
              if aenhance eq '04' then xcalc=(1.0-0.2485)/(2.3426*(1.+1.993*10^(zh[j]+ALOG10(0.0253)))-1.3426)
;see Garretts email explaining the correction factors
;GS1998 Protosolar
; i didn't double check this so if something looks weird it might be the above

	     zcalc=(1.+10^(zh[j]+ALOG10(0.0253)))*xcalc-xcalc

;             xcalc=(1.-ys)/(1.+10^(zh[j]+ALOG10(0.0253))) ;GS1998 Protosolar
;             zcalc=1-ys-xcalc
             
             xcs=string(xcalc)
             zcs=string(zcalc)
             xstr=strmid(strcompress(xcs, /remove_all), 0, 9)
             zstr=strmid(strcompress(zcs, /remove_all), 0, 9)

; use the Tayar 2017 mixing length calibration
             alpha=0.162*zh[j]+1.90
             alphas=strcompress(string(alpha), /remove_all)
;	     print, alphas
;wait, 100
             opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'
             opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
             opnum=value_locate(opaloptions, zcalc)
             opname=opbase+opalstr[opnum]+'"'


             FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"
             Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al00_nodiff.last'"

;             newname=mname[ii]+'Mo3FTF'+wname[k]
;             newname=mname[ii]+'MrhFTF'+wname[k]

   	      losson='.FALSE.'
              newname=mname(ii)+'fh'+zhname(j)+'rhFTF'+wname[k]

;K for kawaler wind loss law, should maybe enforce wmax=10, fk=2.62, LMWIND=False
              if ms[ii] le 1.3 then newname=mname(ii)+'fh'+zhname(j)+'rhFTK'+wname[k] ; used to be FTK 
              if ms[ii] le 1.3 then losson='.TRUE.'
;add this bit for toi 197
              if ms[ii] le 1.6 then newname=mname(ii)+'fh'+zhname(j)+'rhFTV'+wname[k] ; used to be FTK 
              if ms[ii] le 1.6 then losson='.TRUE.'
 
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FLIV95 ', 'WNEW ', 'TDISK ', 'PDISK ', 'LWNEW ', 'LDISK ', 'LJDOT0 ']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas, alphas, opal95, worig[k], Tdisk[k], worig[k],'.TRUE.', '.TRUE.', losson]

             if fil1 ne newname then $
                   createnmls2,  dir,fil1, newname, params, values                
           end
         end
       end
    end

     endif






; don't use this, it doesn't actually work yet i don't think. just use the general grid generation code and then change the starting model
     if type eq 'MYZaAlphaAtmCNgrid' then begin
      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     
      print, fil1
 
      

       ms=['0.60D0', '0.70D0', '0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', $
           '1.50D0', '1.60D0', '1.70D0', '1.80D0', '1.90D0', '2.00D0', '2.10D0', '2.20D0', $
           '2.30D0', '2.40D0', '2.50D0', '2.60D0'  ]
       mname=['060', '070','080', '090', '100', '110','120', '130','140', '150','160',$
              '170', '180','190', '200', '210', '220','230', '240','250', '260']

       ys=[0.239, 0.272683, 0.290,0.330]
       yname=['239', '273', '290','330']

       zh=[0.60, 0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4, -1.6, -1.8, -2.0]
       zhname=['p060','p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140','m160', 'm180', 'm200']

       as=['17', '12', '22']
       alphas=['1.724485D0', '1.224485D0', '2.224485D0']
; for castelli/kurucz atype=5,  ys=[ 0.265116], alphas=['1.754000D0']
; for grey atype=0,  ys=[ 0.265205], alphas=['1.699653D0'] ; with o3 numerics, actually '1.695867D0',0.264585

       atype='0'  
       atypename='gr' ;'ck'
 
       aenhances=['00', '02','04']
       cnenhances=['00', '02', '04']


;       zh=[0.6]
;       zhname=['p060'];
;        ms=[ $
;           '2.00D0', '2.10D0', '2.20D0', $
;           '2.30D0', '2.40D0', '2.50D0', '2.60D0'  ]
;       mname=[ '200', '210', '220','230', '240','250', '260']
;       ms=['0.60D0', '0.70D0', '0.80D0', '0.90D0', '1.00D0', '1.10D0', '1.20D0', '1.30D0', '1.40D0', $
;           '1.50D0', '1.60D0', '1.70D0', '1.80D0', '1.90D0' ]
;       mname=['060', '070','080', '090', '100', '110','120', '130','140', '150','160',$
;              '170', '180','190']

;        ms=[ $
;           '2.00D0', '2.10D0',  $
;           '2.30D0', '2.40D0', '2.50D0'  ]
;       mname=[ '200', '210','230', '240','250']
;       ms= ['0.70D0', '0.80D0', '0.90D0',  '1.10D0', '1.20D0', '1.30D0',  $
;         '1.50D0', '1.60D0', '1.70D0',  '1.90D0' ]
;       mname=[ '070','080', '090',  '110','120', '130', '150','160',$
;              '170', '190']

;       zh=[0.40, 0.00,  -0.4, -0.8,   -1.2, -1.6, -2.0]
;       zhname=['p040',  'm000', 'm040',  'm080', 'm120', 'm160',  'm200']
;       zh=[ 0.20, -0.2,  -0.6,  -1.0, -1.4, -1.8]
;       zhname=[ 'p020', 'm020','m060', 'm100',  'm140', 'm180']



;       ms=['1.00D0']
;       mname=['100']
;       zh=[0.0]
;       zhname=['m000']
;       ys=[0.2701]
;       yname=[ '270']
;       as=['18'];
;       alphas=['1.8D0']

;       aenhances=['00']

; for castelli/kurucz atype=5,  ys=[ 0.265116], alphas=['1.754000D0']
; for grey atype=0,  ys=[ 0.265205], alphas=['1.699653D0']





       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
                      
        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]  
     
        newatmoptions=[-4.0,-2.5, -2.0, -1.5, -1,$
                       -.5, 0.0, 0.5 ]
        newatmstr=[ 'm40', 'm25',   'm20','m15','m10',$
                    'm05','p00', 'p05' ]    

        moptions=[.15, .20, .25, .30, .35, .40, .45, .50, .55, .60, .65, .70, .75, .80, $
                  .85, .90, .95, 1.0, 1.05, 1.10, 1.15, $
                  1.20, 1.25, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, 2.00, 2.25, 2.50, 2.80]      
        mstr=['015', '020', '025', '030', '035', '040', '045', '050', '055', '060', '065', '070', '075', $
                  '080', '085', '090', '095', '100', '105', '110', '115', $
                  '120', '125', '130', '140', '150', '160', '170', '180', '190', '200', '225', '250', '280']

        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.30, 2.40, 2.50, 2.60]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220', '230', '240', '250', '260']
       zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']


;       if (n_elements(zs) ne n_elements(xs) || n_elements(xs) ne n_elements(zoxs)) then begin
;            print, 'z, x, z/x lists not same length- please fix and retry'
;            cd, '~/EVOLUTION/output/idl'
;            return
;       endif
       if (n_elements(ms) ne n_elements(mname)) then begin
            print, 'm, mname lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif
     for nn=0, n_elements(cnenhances)-1 do begin
          cnenhace=cnenhances[nn]
      for m=0, n_elements(aenhances)-1 do begin
          aenhance=aenhances[m]
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(ys)-1 do begin
           for k=0, n_elements(zh)-1 do begin
             for l=0, n_elements(as)-1 do begin 


                 mnum=value_locate(moptionsnew, ms[ii])
                 if ms[ii] lt moptionsnew(mnum) then mnum=mnum-1
                 mbelow=mstrnew[mnum]
                 znum=value_locate(zoptionsnew, zh[k])
                 zbelow=zstrnew[znum]

                 FFIRSTbase="'/home/tayar.1/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"

;for the alpha enhancement zero stars, use the newstarts2 grid of starting models so that 
; we don't have to rescale so far at various metallicities 
                if aenhance eq '00' then begin
 


                      kttau=atype
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'

;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"

                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al00_nodiff.last'"
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
                      if atype eq '5' then begin
                             atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                             atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                             atmname=atmbase+newatmstr[atmnum]+'.tab"'  
                      endif
                endif else if aenhance eq '04' then begin
                      kttau=atype
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al04.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al04_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else if aenhance eq '02' and atype eq '0' then begin
                      kttau=atype
                      opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al02.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al02_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else begin
                      kttau=atype
                      atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
	              FFIRSTbase="'/home/tayar.1/EVOLUTION/input/models/"
                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
                          "gs98alpha"+aenhance+"z01757.ahbl'"
                     opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                endelse

;               if as[k] eq '2' then Fname=FFIRSTbase+"alpha06/p"+mbelow(i)+$
;                    "gs98alpha02z01757.ahbl'"

       

;                 newname=filename+'m'+strmid(ms(ii), 2, 2)+'z'+zoxs(j)+'a'+as(l)+'_nodiff'
;                 xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar

   		 if aenhance eq '00' then xcalc=(1.-ys[j])/(1.+10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar
		 if aenhance eq '02' then xcalc=(1.-ys[j])/(1.+1.383*10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar  ;see Garretts email explaining the correction factors
		 if aenhance eq '04' then xcalc=(1.-ys[j])/(1.+1.993*10^(zh[k]+ALOG10(0.0253))) ;GS1998 Protosolar	

                 zcalc=1-ys[j]-xcalc
                 xcs=string(xcalc)
                 zcs=string(zcalc)
                 xstr=strmid(strcompress(xcs, /remove_all), 0, 9)
                 zstr=strmid(strcompress(zcs, /remove_all), 0, 9)

                 opbase='"/home/tayar.1/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
                 opnum=value_locate(opaloptions, zcalc)
                 opname=opbase+opalstr[opnum]+'"'
;                 atmbase='"/home/tayar.1/EVOLUTION/input/atmos/kurucz/atmk1990'
;                 atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
;                 atmname=atmbase+atmstr[atmnum]+'.tab"'                
                

                 newname='m'+mname(ii)+'fh'+zhname(k)+'y'+yname(j)+'a'+as(l)+'al'+aenhance+'_'+atypename+'nodf'
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FLIV95 ', 'FATM', 'KTTAU']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas[l], alphas[l], opal95, atmname, kttau]

                 if fil1 ne newname then $
                       createnmls2,  dir,fil1, newname, params, values  
        
             end
           end
         end
       end
     end
    end
     endif




     if type eq 'subgiant' then begin ;Tayar and Pinsonneault 2018 grid updated to subgiants

      newdir= '~/EVOLUTION/output/'+dir
      cd, newdir
      D=file_search('*.nml2')
      fil1=strmid(D(0), 0, strlen(D(0))-10) ;remove the yrec8.nml2     

      print, fil1

;       ms=['2.0D0','2.2D0', '2.4D0', '2.6D0', '2.8D0', '3.0D0']
;       mbelow=['200', '200', '225', '250', '280', '280']
;       mname=['2_0', '2_2', '2_4', '2_6', '2_8', '3_0'] 

;       ms=['1.0D0','1.2D0', '1.4D0', '1.6D0', '1.8D0']
;       mbelow=['200', '200', '225', '250', '280', '280']
;       mname=['1_0', '1_2', '1_4', '1_6', '1_8'] 
;       ms=['0.8D0', '1.0D0','1.2D0', '1.4D0', '1.6D0', '1.8D0','2.0D0','2.2D0', '2.4D0', '2.6D0', '2.8D0', '3.0D0']
;       mname=['0_8','1_0', '1_2', '1_4', '1_6', '1_8','2_0', '2_2', '2_4', '2_6', '2_8', '3_0'] 
 
;runing toi 197
;       ms=['0.5', '0.6D0','0.70D0',  '0.80D0', '0.9D0', '1.0D0', '1.1D0', '1.2D0','1.3D0', '1.4D0','1.5D0', '1.6D0','1.7D0', '1.8D0','1.9D0','2.0D0']
;       mname=[ '0_50','0_60', '0_70', '0_80', '0_90','1_00','1_10', '1_20', '1_30', '1_40','1_50', '1_60', '1_70', '1_80', '1_90','2_00'] 
       ms=['0.80D0'];['0.80D0', '0.9D0', '1.0D0', '1.1D0', '1.2D0','1.3D0', '1.4D0','1.5D0', '1.6D0','1.7D0', '1.8D0','1.9D0','2.0D0']
       mname=[ '0_80'];[ '0_80', '0_90','1_00','1_10', '1_20', '1_30', '1_40','1_50', '1_60', '1_70', '1_80', '1_90','2_00'] 
 
;      zh=['0.0']


;       zh=[0.60, 0.40, 0.20, 0.00, -0.2, -0.4, -0.6, -0.8, -1.0, -1.2, -1.4, -1.6, -1.8, -2.0]
;       zhname=['p060','p040', 'p020', 'm000', 'm020', 'm040', 'm060', 'm080', 'm100', 'm120', 'm140','m160', 'm180', 'm200']
;       zh=[0.30,0.0, -0.3]
;       zhname=['p03','m00', 'm03']

;       zh=[0.5, 0.0, -0.5, -1.0] ;-1.37,-1.48, -1.59]
;       zhname=['p050', 'm000', 'm050', 'm100'] ;'m137','m148', 'm159']
       zh=[ -2.5] ;-1.37,-1.48, -1.59]
       zhname=[ 'm250'] ;'m137','m148', 'm159']

;       worig=['5.0D-8', '2.5D-6', '5.0D-6', '7.5D-6', '1.0D-5', '1.0D-5', '1.0D-5']
;       Tdisk=['0.001d0','0.001d0', '0.001d0', '0.001d0', '0.001d0', '0.0008d0','0.0006d0']
;       wname=['w0','w1', 'w2', 'w3', 'w4', 'w5', 'w6']
       worig=[ '7.5D-6']
       Tdisk=[ '0.001d0']
       wname=[ 'w3']

      ys=['cali'] ;0.272683
       atype='0'  ; doesn't actually use this I think, which is how we ended up with Kurucz instead of gray atmospheres-- improved to use this!
       atypename='gr'

       aenhances=['00'] ;the problem is if this is 00 i've been using kurucz atmospheres. but can't do alpha enhanced kurucz trivially, so want to do grey in other cases-- now can alpha enhance

       if (n_elements(worig) ne n_elements(Tdisk)) then begin
            print, 'worig, Tdisk lists not same length- please fix and retry'
            cd, '~/EVOLUTION/output/idl'
            return
       endif


       opaloptions=[.000017220, .000054449, .000172129, .000305985, .000543784, .000965916, $
                    .001000000, .001038368, .001039811, .001050452, .001067212, .001096056, $
                    .001171370, .001185001, .001203908, .001236447, .001444000, .001644316, $
                    .001646600, .001663451, .001688526, .001689992, .001714251, .001718041, $
                    .001735667, .001854732, .001876315, .001906252, .001931311, .001936972, $
                    .001937326, .001939065, .001941304, .001941834, .001951151, .001957773, $
                    .001967802, .002000000, .002602589, .002606204, .002632875, .002674883, $
                    .002714609, .002714746, .002747177, .002935130, .002969285, .003000000, $
                    .003016661, .003037668, .003061610, .003098193, .003444000, .004000000, $
                    .004116123, .004121840, .004164021, .004230460, .004344797, .004640802, $
                    .004694806, .004769713, .004898624, .005000000, .005368163, .005444000, $
                    .006000000, .006501875, .006577536, .006682483, .006733295, .006863090, $
                    .007000000, .007327551, .007412820, .007444000, .007531094, .007734637, $
                    .008000000, .008437702, .009000000, .009444000, .010000000, .010250636, $
                    .010264873, .010369920, .010535376, .010561242, .010820115, .011000000, $
                    .011444000, .011544666, .011679008, .011865351, .012000000, .012186036, $
                    .013000000, .013200081, .013444000, .014000000, .014760018, .015000000, $
                    .015444000, .016000000, .016111996, .016299487, .016465295, .016465591, $
                    .016467650, .016559552, .017000000, .017007107, .017444000, .018000000, $
                    .018127060, .018256818, .018298713, .018298972, .018334365, .018338000, $
                    .018338378, .018407800, .018596758, .018630590, .018664570, .019000000, $
                    .019134119, .019444000, .020000000, .020166951, .020500932, .020623244, $
                    .020727145, .021000000, .021196113, .021393150, .021444000, .021840707, $
                    .021880056, .022000000, .022337799, .023000000, .023444000, .024000000, $
                    .025000000, .025205883, .025444000, .025450839, .025499197, .025906047, $
                    .026000000, .026606210, .027000000, .027444000, .028000000, .028312537, $
                    .028642003, .029000000, .029098996, .029444000, .029885456, .030000000, $
                    .031000000, .031444000, .031490336, .038266667, .038804833, .038881687, $
                    .039147056, .039602600, .040234474, .041321892, .043163970, .043276547, $
                    .043297159, .043373164, .043558181, .043863498, .043863559, .043888364]

           opalstr=['.000017220', '.000054449', '.000172129', '.000305985', '.000543784', '.000965916', $
                    '.001000000', '.001038368', '.001039811', '.001050452', '.001067212', '.001096056', $
                    '.001171370', '.001185001', '.001203908', '.001236447', '.001444000', '.001644316', $
                    '.001646600', '.001663451', '.001688526', '.001689992', '.001714251', '.001718041', $
                    '.001735667', '.001854732', '.001876315', '.001906252', '.001931311', '.001936972', $
                    '.001937326', '.001939065', '.001941304', '.001941834', '.001951151', '.001957773', $
                    '.001967802', '.002000000', '.002602589', '.002606204', '.002632875', '.002674883', $
                    '.002714609', '.002714746', '.002747177', '.002935130', '.002969285', '.003000000', $
                    '.003016661', '.003037668', '.003061610', '.003098193', '.003444000', '.004000000', $
                    '.004116123', '.004121840', '.004164021', '.004230460', '.004344797', '.004640802', $
                    '.004694806', '.004769713', '.004898624', '.005000000', '.005368163', '.005444000', $
                    '.006000000', '.006501875', '.006577536', '.006682483', '.006733295', '.006863090', $
                    '.007000000', '.007327551', '.007412820', '.007444000', '.007531094', '.007734637', $
                    '.008000000', '.008437702', '.009000000', '.009444000', '.010000000', '.010250636', $
                    '.010264873', '.010369920', '.010535376', '.010561242', '.010820115', '.011000000', $
                    '.011444000', '.011544666', '.011679008', '.011865351', '.012000000', '.012186036', $
                    '.013000000', '.013200081', '.013444000', '.014000000', '.014760018', '.015000000', $
                    '.015444000', '.016000000', '.016111996', '.016299487', '.016465295', '.016465591', $
                    '.016467650', '.016559552', '.017000000', '.017007107', '.017444000', '.018000000', $
                    '.018127060', '.018256818', '.018298713', '.018298972', '.018334365', '.018338000', $
                    '.018338378', '.018407800', '.018596758', '.018630590', '.018664570', '.019000000', $
                    '.019134119', '.019444000', '.020000000', '.020166951', '.020500932', '.020623244', $
                    '.020727145', '.021000000', '.021196113', '.021393150', '.021444000', '.021840707', $
                    '.021880056', '.022000000', '.022337799', '.023000000', '.023444000', '.024000000', $
                    '.025000000', '.025205883', '.025444000', '.025450839', '.025499197', '.025906047', $
                    '.026000000', '.026606210', '.027000000', '.027444000', '.028000000', '.028312537', $
                    '.028642003', '.029000000', '.029098996', '.029444000', '.029885456', '.030000000', $
                    '.031000000', '.031444000', '.031490336', '.038266667', '.038804833', '.038881687', $
                    '.039147056', '.039602600', '.040234474', '.041321892', '.043163970', '.043276547', $
                    '.043297159', '.043373164', '.043558181', '.043863498', '.043863559', '.043888364']
                      
        atmoptions=[-5.0,-4.5,-4.0, -3.5,-3.3,-3.0, -2.5, -2.3,-2.0,-1.75, -1.7,  -1.5,  -1.3, -1.25, -1,$
                    -.75, -.5,-.4,  -.3,-.2,-.1,  -.05,  $
                       0.0, 0.05, $
                    0.1, 0.12, 0.13, 0.14, 0.15, 0.2, 0.3, 0.4, 0.5,0.75, 1.0 ]
        atmstr=[ 'm50', 'm45','m40', 'm35',  'm33', 'm30', 'm25',   'm23',  'm20','m175','m17','m15','m13','m125','m10',$
                 'm075', 'm05','m04','m03','m02','m01',    'm005', $
                     'p00', 'p005', $
                    'p01', 'p012', 'p013', 'p014', 'p015','p02', 'p03', 'p04', 'p05', 'p075','p10' ]  
     
        newatmoptions=[-4.0,-2.5, -2.0, -1.5, -1,$
                       -.5, 0.0, 0.5 ]
        newatmstr=[ 'm40', 'm25',   'm20','m15','m10',$
                    'm05','p00', 'p05' ]    


        moptionsnew=[.60,.70,.80, .90,  1.0, 1.10,1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, $
                     2.00, 2.10, 2.20, 2.30, 2.40, 2.50, 2.60]      
        mstrnew=['060',  '070', '080','090', '100', '110','120','130', '140', '150', '160', $
                 '170', '180', '190', '200', '210','220', '230', '240', '250', '260']
       zoptionsnew=[-2.00, -1.6, -1.2, -0.8, -0.4, 0.0, 0.4]
       zstrnew=['m200', 'm160', 'm120','m080', 'm040','m000', 'p040']

      for m=0, n_elements(aenhances)-1 do begin
          aenhance=aenhances[m]
       for ii=0, n_elements(ms)-1 do begin
         for j=0, n_elements(zh)-1 do begin
           for k=0, n_elements(Tdisk)-1 do begin
             
             mnum=value_locate(moptionsnew, ms[ii])
             if ms[ii] lt moptionsnew(mnum) then mnum=mnum-1
             mbelow=mstrnew[mnum]
             znum=value_locate(zoptionsnew, zh[j])
             zbelow=zstrnew[znum]



;calculate x and z assuming Tayar 2017 delta Y/delta Z
              if aenhance eq '00' then xcalc=(1.0-0.2485)/(2.3426*(1.+10^(zh[j]+ALOG10(0.0253)))-1.3426)
              if aenhance eq '02' then xcalc=(1.0-0.2485)/(2.3426*(1.+1.383*10^(zh[j]+ALOG10(0.0253)))-1.3426)
              if aenhance eq '04' then xcalc=(1.0-0.2485)/(2.3426*(1.+1.993*10^(zh[j]+ALOG10(0.0253)))-1.3426)
;see Garretts email explaining the correction factors
;GS1998 Protosolar
; i didn't double check this so if something looks weird it might be the above

	     zcalc=(1.+10^(zh[j]+ALOG10(0.0253)))*xcalc-xcalc
             print, zcalc
;             xcalc=(1.-ys)/(1.+10^(zh[j]+ALOG10(0.0253))) ;GS1998 Protosolar
;             zcalc=1-ys-xcalc
             
             xcs=string(xcalc)
             zcs=string(zcalc)
             xstr=strmid(strcompress(xcs, /remove_all), 0, 9)
             zstr=strmid(strcompress(zcs, /remove_all), 0, 9)

; use the Tayar 2017 mixing length calibration
             alpha=0.162*zh[j]+1.90
             alphas=strcompress(string(alpha), /remove_all)
;	     print, alphas
;wait, 100

;for the alpha enhancement zero stars, use the newstarts2 grid of starting models so that 
; we don't have to rescale so far at various metallicities 
             FFIRSTbase="'/home/jtayar/EVOLUTION/output/YRECgrid/nodiff/newstarts3/"
             Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al00_nodiff.last'"

                if aenhance eq '00' then begin
 


                      kttau=atype
                      opal95='"/home/jtayar/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'

;                Fname=FFIRSTbase+"pms/gs98/p"+mbelow+"gs98z01757.ahbl'"

                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al00_nodiff.last'"
                      atmbase='"/home/jtayar/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
                      if atype eq '5' then begin
                             atmbase='"/home/jtayar/EVOLUTION/input/atmos/kurucz/atmk2004'
                             atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                             atmname=atmbase+newatmstr[atmnum]+'.tab"'  
                      endif
                endif else if aenhance eq '04' then begin
                      kttau=atype
                      opal95='"/home/jtayar/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/jtayar/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al04.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al04_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else if aenhance eq '02' and atype eq '0' then begin
                      kttau=atype
                      opal95='"/home/jtayar/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                      atmbase='"/home/jtayar/EVOLUTION/input/atmos/kurucz/atmk2004'
                      atmnum=value_locate(newatmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+newatmstr[atmnum]+'al02.tab"'   
                      Fname=FFIRSTbase+'m'+mbelow+'fh'+zbelow+'y'+'264'+'a'+'18'+"al02_nodiff.last'"
;                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
;                          "gs98alpha"+aenhance+"z01757.ahbl'"
                endif else begin
                      kttau=atype
                      atmbase='"/home/jtayar/EVOLUTION/input/atmos/kurucz/atmk1990'
                      atmnum=value_locate(atmoptions, zh[k])         ; changed from k-1 to k
                      atmname=atmbase+atmstr[atmnum]+'.tab"'   
	              FFIRSTbase="'/home/jtayar/EVOLUTION/input/models/"
                      Fname=FFIRSTbase+"alpha"+aenhance+"/p"+mbelow+$
                          "gs98alpha"+aenhance+"z01757.ahbl'"
                     opal95='"/home/jtayar/EVOLUTION/input/opacity/opal95/GS98alpha'+aenhance+'JT.OP17"'
                endelse



 ;            opal95='"/home/tayar.1/EVOLUTION/input/opacity/opal95/GS98.OPAL17"'
             opbase='"/home/jtayar/EVOLUTION/input/eos/opal2006/EOSOPAL06Z0'
             opnum=value_locate(opaloptions, zcalc)
             opname=opbase+opalstr[opnum]+'"'




;             newname=mname[ii]+'Mo3FTF'+wname[k]
;             newname=mname[ii]+'MrhFTF'+wname[k]

   	      losson='.FALSE.'
              newname=mname(ii)+'fh'+zhname(j)+'al'+aenhance+atypename+'rhFTF'+wname[k]

;K for kawaler wind loss law, should maybe enforce wmax=10, fk=2.62, LMWIND=False
;              if ms[ii] le 1.3 then newname=mname(ii)+'fh'+zhname(j)+'al'+aenhance+atypename+'rhFTK'+wname[k] ; used to be FTK 
;              if ms[ii] le 1.3 then losson='.TRUE.'
;add this bit for nu indi- should maybe enforce ALFA = 1.5 FK = 6.54 LSOLWIND = .TRUE. LMDOT = .FALSE. LMWIND = .TRUE. AWIND = V13 LROSSBY = .TRUE.
              if ms[ii] le 100 then newname=mname(ii)+'fh'+zhname(j)+'al'+aenhance+atypename+'rhFTV'+wname[k] ; used to be FTK ;used to be 1.3, but apparently it shuts itself off???
              if ms[ii] le 1.3 then losson='.TRUE.'
 
                 params=['RSCLM(1)', 'RSCLX(1)', 'RSCLZ(1)', 'XENV0A(1)', 'ZENV0A(1)', $
                         'XENV0A(2)', 'ZENV0A(2)', 'ZALEX1', 'ZOPAL951', 'FFIRST',$
                         'FOPALE06', 'CMIXLA(1)', 'CMIXLA(2)', 'FLIV95 ','FATM', 'KTTAU ', 'WNEW ', 'TDISK ', 'PDISK ', 'LWNEW ', 'LDISK ', 'LJDOT0 ']
                 values=[ms[ii], xstr, zstr, xstr, zstr,xstr, zstr, zstr, zstr, $
                        Fname, opname, alphas, alphas, opal95, atmname, kttau, worig[k], Tdisk[k], worig[k],'.TRUE.', '.TRUE.', losson]



             if fil1 ne newname then $
                   createnmls2,  dir,fil1, newname, params, values                
           end
         end
       end
    end

     endif











   end
   cd, '~/EVOLUTION/output/idl'
end
